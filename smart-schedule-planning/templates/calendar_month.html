<!-- templates/calendar_month.html -->
{% extends "base.html" %}

{% block title %}Календарь - {{ current_date.strftime('%B %Y') }}{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1>Календарь - {{ current_date.strftime('%B %Y') }}</h1>
        <div class="btn-group mt-3">
            <a href="{{ url_for('calendar.calendar_view', view='month', date=prev_month) }}" 
               class="btn btn-outline btn-sm">
                <i class="fas fa-chevron-left"></i> Предыдущий
            </a>
            <a href="{{ url_for('calendar.calendar_view', view='month', date=next_month) }}" 
               class="btn btn-outline btn-sm">
                Следующий <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>
    
    <div class="card mt-3">
        <div class="card-body p-0">
            <!-- КАЛЕНДАРЬ С ИНЛАЙН-СТИЛЯМИ -->
            <div style="
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                width: 100%;
                border: 1px solid #dee2e6;
                background: #e9ecef;
                gap: 1px;
            ">
                <!-- Заголовки дней недели -->
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Пн</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Вт</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Ср</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Чт</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Пт</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Сб</div>
                <div style="
                    padding: 12px;
                    text-align: center;
                    background: #f8f9fa;
                    font-weight: 600;
                    color: #495057;
                    font-size: 0.9em;
                ">Вс</div>
                
                <!-- Дни месяца -->
                {% for day in days %}
                <div style="
                    min-height: 100px;
                    background: {% if not day.is_current_month %}#f8f9fa{% else %}white{% endif %};
                    padding: 8px;
                    border: 1px solid #dee2e6;
                    opacity: {% if not day.is_current_month %}0.7{% else %}1{% endif %};
                ">
                    <div style="
                        font-weight: 600;
                        font-size: 1.1em;
                        margin-bottom: 5px;
                        color: {% if not day.is_current_month %}#adb5bd{% else %}#212529{% endif %};
                    ">
                        {{ day.day }}
                        {% if day.tasks or day.events %}
                        <small style="
                            color: #007bff;
                            font-size: 0.7em;
                        ">•</small>
                        {% endif %}
                    </div>
                    
                    {% if day.tasks %}
                        {% for task in day.tasks[:2] %}
                        <div style="
                            font-size: 0.75em;
                            padding: 3px 4px;
                            margin: 2px 0;
                            border-radius: 3px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                            background: {% if task.priority == 'высокий' %}#dc3545
                                      {% elif task.priority == 'средний' %}#ffc107
                                      {% else %}#28a745{% endif %};
                            color: {% if task.priority == 'средний' %}#212529{% else %}white{% endif %};
                        ">
                            {% if task.start_time %}
                            <small>{{ task.start_time[11:16] }}</small>
                            {% endif %}
                            {{ task.title|truncate(12) }}
                        </div>
                        {% endfor %}
                        
                        {% if day.tasks|length > 2 %}
                        <div style="
                            font-size: 0.7em;
                            color: #6c757d;
                            text-align: center;
                            padding: 2px;
                            background: #f8f9fa;
                            border-radius: 2px;
                            margin-top: 2px;
                        ">
                            +{{ day.tasks|length - 2 }} еще
                        </div>
                        {% endif %}
                    {% endif %}
                    
                    {% if day.events %}
                        {% for event in day.events[:1] %}
                        <div style="
                            font-size: 0.75em;
                            padding: 2px 4px;
                            margin: 2px 0;
                            background: #e9ecef;
                            border-radius: 3px;
                            color: #6c757d;
                            display: flex;
                            align-items: center;
                            gap: 4px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                        ">
                            <i class="fas fa-calendar-alt" style="font-size: 0.7em;"></i>
                            {{ event.title|truncate(8) }}
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <!-- ОТЛАДОЧНАЯ ИНФОРМАЦИЯ -->
            <div class="mt-4 p-3" style="background: #f8f9fa; border-radius: 6px;">
                <h5>Отладочная информация:</h5>
                <ul class="mb-0">
                    <li>Всего дней: {{ days|length }}</li>
                    <li>Текущий месяц: {{ current_date.strftime('%B %Y') }}</li>
                    <li>Дней с задачами: {{ days|selectattr('task_count', 'gt', 0)|list|length }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* Обязательные стили для календаря */
.mt-3 { margin-top: 1rem !important; }
.mt-4 { margin-top: 1.5rem !important; }
.mb-0 { margin-bottom: 0 !important; }
.p-3 { padding: 1rem !important; }

.btn-group {
    display: inline-flex;
    gap: 0.5rem;
}

.btn {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    background: white;
    color: #495057;
    text-decoration: none;
    font-size: 0.875rem;
}

.btn:hover {
    background: #f8f9fa;
}

.btn-outline {
    background: transparent;
    border: 1px solid #007bff;
    color: #007bff;
}

.btn-outline:hover {
    background: #007bff;
    color: white;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
}
</style>
{% endblock %}